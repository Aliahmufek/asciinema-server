// ascii.io - embeddable widget

(function() {
  function receiveSize(e) {
    if (e.origin === document.location.protocol + "//<%= request.host %>") {
      var event = e.data[0];
      var data  = e.data[1];
      if (event == 'asciicast:size' && data.id == <%= @asciicast.id %>) {
        var player = document.getElementById("asciicast-player-<%= @asciicast.id %>");
        if (player) {
          player.style.width  = data.width;
          player.style.height = data.height;
        }
      }
    }
  }

  window.addEventListener("message", receiveSize, false);

  document.writeln('<div class="asciicast" style="display: block; float: none; overflow: hidden"><iframe src="http://<%= request.host_with_port %>/a/<%= @asciicast.id %>/raw" name="asciicast-player-<%= @asciicast.id %>" id="asciicast-player-<%= @asciicast.id %>" width="600" height="300" scrolling="no" marginheight="0" marginwidth="0" frameborder="0" style="display: block; float: none; visibility: hidden;" onload="this.style.visibility=\'visible\';"></iframe></div>');
})();
